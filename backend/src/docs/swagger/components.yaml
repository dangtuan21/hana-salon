components:
  schemas:
    ApiResponse:
      type: object
      properties:
        success:
          type: boolean
          description: Indicates if the request was successful
        data:
          type: object
          description: Response data (varies by endpoint)
        message:
          type: string
          description: Human-readable message
        timestamp:
          type: string
          format: date-time
          description: ISO timestamp of the response
      required: [success, timestamp]

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          description: Error code
        message:
          type: string
          description: Error message
        timestamp:
          type: string
          format: date-time
        statusCode:
          type: integer
          description: HTTP status code
      required: [success, error, message, timestamp, statusCode]

    HealthCheckResponse:
      type: object
      properties:
        status:
          type: string
          enum: [healthy, unhealthy]
          description: Overall health status
        timestamp:
          type: string
          format: date-time
        uptime:
          type: integer
          description: Server uptime in seconds
        version:
          type: string
          description: Application version
        environment:
          type: string
          description: Current environment
        services:
          type: object
          properties:
            database:
              type: string
              enum: [connected, disconnected]
            aiService:
              type: string
              enum: [connected, disconnected]
      required: [status, timestamp, uptime, version, environment]

    Service:
      type: object
      properties:
        _id:
          type: string
          description: Unique service identifier
          example: "691bf2c5779a3bff78c776e7"
        name:
          type: string
          description: Service name
          example: "Classic Manicure"
        category:
          type: string
          description: Service category
          example: "Basic Services"
        duration_minutes:
          type: integer
          minimum: 1
          maximum: 300
          description: Service duration in minutes
          example: 45
        price:
          type: number
          minimum: 0
          description: Service price in dollars
          example: 35
        description:
          type: string
          description: Service description
          example: "Traditional nail care with cuticle treatment, shaping, and regular polish"
        required_skill_level:
          type: string
          enum: [Junior, Senior, Expert, Master]
          description: Required skill level for technician
          example: "Junior"
        popularity_score:
          type: integer
          minimum: 0
          maximum: 10
          description: Service popularity score (0-10)
          example: 8
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
          example: "2025-11-18T04:15:01.850Z"
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp
          example: "2025-11-18T04:15:01.850Z"
      required: [_id, name, category, duration_minutes, price, created_at, updated_at]

    ServiceInput:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Service name
          example: "Classic Manicure"
        category:
          type: string
          minLength: 1
          maxLength: 50
          description: Service category
          example: "Basic Services"
        duration_minutes:
          type: integer
          minimum: 1
          maximum: 300
          description: Service duration in minutes
          example: 45
        price:
          type: number
          minimum: 0
          description: Service price in dollars
          example: 35
        description:
          type: string
          maxLength: 500
          description: Service description
          example: "Traditional nail care with cuticle treatment, shaping, and regular polish"
        required_skill_level:
          type: string
          enum: [Junior, Senior, Expert, Master]
          description: Required skill level for technician
          example: "Junior"
        popularity_score:
          type: integer
          minimum: 0
          maximum: 10
          description: Service popularity score (0-10)
          example: 8
      required: [name, category, duration_minutes, price]

    ServiceUpdate:
      type: object
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: Service name
          example: "Premium Classic Manicure"
        category:
          type: string
          minLength: 1
          maxLength: 50
          description: Service category
          example: "Basic Services"
        duration_minutes:
          type: integer
          minimum: 1
          maximum: 300
          description: Service duration in minutes
          example: 50
        price:
          type: number
          minimum: 0
          description: Service price in dollars
          example: 40
        description:
          type: string
          maxLength: 500
          description: Service description
          example: "Enhanced traditional nail care with premium products"
        required_skill_level:
          type: string
          enum: [Junior, Senior, Expert, Master]
          description: Required skill level for technician
          example: "Senior"
        popularity_score:
          type: integer
          minimum: 0
          maximum: 10
          description: Service popularity score (0-10)
          example: 9
      description: All fields are optional for updates

    # Customer Schemas
    Customer:
      type: object
      properties:
        _id:
          type: string
          description: Unique customer identifier
          example: "691bf2c5779a3bff78c776e7"
        firstName:
          type: string
          description: Customer's first name
          example: "Sarah"
        lastName:
          type: string
          description: Customer's last name
          example: "Johnson"
        email:
          type: string
          format: email
          description: Customer's email address
          example: "sarah.johnson@email.com"
        phone:
          type: string
          description: Customer's phone number
          example: "+1234567890"
        dateOfBirth:
          type: string
          format: date
          description: Customer's date of birth
          example: "1990-05-15"
        gender:
          type: string
          enum: [male, female, other, prefer_not_to_say]
          description: Customer's gender
          example: "female"
        address:
          type: object
          properties:
            street:
              type: string
              example: "123 Main St"
            city:
              type: string
              example: "New York"
            state:
              type: string
              example: "NY"
            zipCode:
              type: string
              example: "10001"
            country:
              type: string
              example: "United States"
        preferences:
          type: object
          properties:
            preferredTechnician:
              type: string
              description: ID of preferred technician
              example: "691bf2c5779a3bff78c776e8"
            allergies:
              type: array
              items:
                type: string
              example: ["latex", "shellfish"]
            notes:
              type: string
              example: "Prefers morning appointments"
        loyaltyPoints:
          type: integer
          minimum: 0
          description: Customer's loyalty points
          example: 150
        totalVisits:
          type: integer
          minimum: 0
          description: Total number of visits
          example: 12
        totalSpent:
          type: number
          minimum: 0
          description: Total amount spent
          example: 450.75
        isActive:
          type: boolean
          description: Whether the customer is active
          example: true
        created_at:
          type: string
          format: date-time
          description: Customer creation timestamp
          example: "2023-11-18T00:15:00.000Z"
        updated_at:
          type: string
          format: date-time
          description: Customer last update timestamp
          example: "2023-11-18T00:15:00.000Z"

    CustomerInput:
      type: object
      required:
        - firstName
        - lastName
        - email
        - phone
      properties:
        firstName:
          type: string
          maxLength: 50
          description: Customer's first name
          example: "Sarah"
        lastName:
          type: string
          maxLength: 50
          description: Customer's last name
          example: "Johnson"
        email:
          type: string
          format: email
          description: Customer's email address
          example: "sarah.johnson@email.com"
        phone:
          type: string
          pattern: "^[\\+]?[1-9][\\d]{0,15}$"
          description: Customer's phone number
          example: "+1234567890"
        dateOfBirth:
          type: string
          format: date
          description: Customer's date of birth
          example: "1990-05-15"
        gender:
          type: string
          enum: [male, female, other, prefer_not_to_say]
          description: Customer's gender
          example: "female"
        address:
          type: object
          properties:
            street:
              type: string
              maxLength: 100
              example: "123 Main St"
            city:
              type: string
              maxLength: 50
              example: "New York"
            state:
              type: string
              maxLength: 50
              example: "NY"
            zipCode:
              type: string
              maxLength: 20
              example: "10001"
            country:
              type: string
              maxLength: 50
              example: "United States"
        preferences:
          type: object
          properties:
            preferredTechnician:
              type: string
              description: ID of preferred technician
              example: "691bf2c5779a3bff78c776e8"
            allergies:
              type: array
              items:
                type: string
              example: ["latex", "shellfish"]
            notes:
              type: string
              maxLength: 500
              example: "Prefers morning appointments"

    CustomerUpdate:
      type: object
      properties:
        firstName:
          type: string
          maxLength: 50
          description: Customer's first name
          example: "Sarah"
        lastName:
          type: string
          maxLength: 50
          description: Customer's last name
          example: "Johnson"
        email:
          type: string
          format: email
          description: Customer's email address
          example: "sarah.johnson@email.com"
        phone:
          type: string
          pattern: "^[\\+]?[1-9][\\d]{0,15}$"
          description: Customer's phone number
          example: "+1234567890"
        dateOfBirth:
          type: string
          format: date
          description: Customer's date of birth
          example: "1990-05-15"
        gender:
          type: string
          enum: [male, female, other, prefer_not_to_say]
          description: Customer's gender
          example: "female"
        address:
          type: object
          properties:
            street:
              type: string
              maxLength: 100
              example: "123 Main St"
            city:
              type: string
              maxLength: 50
              example: "New York"
            state:
              type: string
              maxLength: 50
              example: "NY"
            zipCode:
              type: string
              maxLength: 20
              example: "10001"
            country:
              type: string
              maxLength: 50
              example: "United States"
        preferences:
          type: object
          properties:
            preferredTechnician:
              type: string
              description: ID of preferred technician
              example: "691bf2c5779a3bff78c776e8"
            allergies:
              type: array
              items:
                type: string
              example: ["latex", "shellfish"]
            notes:
              type: string
              maxLength: 500
              example: "Prefers morning appointments"
        isActive:
          type: boolean
          description: Whether the customer is active
          example: true
      description: All fields are optional for updates

    Pagination:
      type: object
      properties:
        page:
          type: integer
          description: Current page number
          example: 1
        limit:
          type: integer
          description: Items per page
          example: 10
        total:
          type: integer
          description: Total number of items
          example: 25
        pages:
          type: integer
          description: Total number of pages
          example: 3

    # Technician Schemas
    Technician:
      type: object
      properties:
        _id:
          type: string
          description: Unique technician identifier
          example: "691bf2c5779a3bff78c776e8"
        firstName:
          type: string
          description: Technician's first name
          example: "Emily"
        lastName:
          type: string
          description: Technician's last name
          example: "Chen"
        email:
          type: string
          format: email
          description: Technician's email address
          example: "emily.chen@hanasalon.com"
        phone:
          type: string
          description: Technician's phone number
          example: "+1234567891"
        employeeId:
          type: string
          description: Unique employee identifier
          example: "EMP001"
        specialties:
          type: array
          items:
            type: string
            enum: [Manicure, Pedicure, Nail Art, Gel Polish, Acrylic Nails, Dip Powder, Nail Extensions, Nail Repair, Cuticle Care, Hand Massage, Foot Massage]
          description: Technician's specialties
          example: ["Manicure", "Nail Art", "Gel Polish"]
        skillLevel:
          type: string
          enum: [Junior, Senior, Expert, Master]
          description: Technician's skill level
          example: "Senior"
        certifications:
          type: array
          items:
            type: string
          description: Professional certifications
          example: ["Certified Nail Technician", "Advanced Nail Art"]
        yearsOfExperience:
          type: integer
          minimum: 0
          maximum: 50
          description: Years of experience
          example: 5
        hourlyRate:
          type: number
          minimum: 10
          maximum: 200
          description: Hourly rate in USD
          example: 45.00
        availability:
          $ref: '#/components/schemas/TechnicianAvailability'
        rating:
          type: number
          minimum: 1
          maximum: 5
          description: Average customer rating
          example: 4.8
        totalBookings:
          type: integer
          minimum: 0
          description: Total number of bookings
          example: 150
        completedBookings:
          type: integer
          minimum: 0
          description: Number of completed bookings
          example: 142
        isActive:
          type: boolean
          description: Whether the technician is active
          example: true
        hireDate:
          type: string
          format: date
          description: Date when technician was hired
          example: "2022-03-15"
        created_at:
          type: string
          format: date-time
          description: Technician creation timestamp
          example: "2023-11-18T00:15:00.000Z"
        updated_at:
          type: string
          format: date-time
          description: Technician last update timestamp
          example: "2023-11-18T00:15:00.000Z"

    TechnicianInput:
      type: object
      required:
        - firstName
        - lastName
        - email
        - phone
        - employeeId
        - specialties
        - skillLevel
        - yearsOfExperience
        - hourlyRate
        - hireDate
      properties:
        firstName:
          type: string
          maxLength: 50
          description: Technician's first name
          example: "Emily"
        lastName:
          type: string
          maxLength: 50
          description: Technician's last name
          example: "Chen"
        email:
          type: string
          format: email
          description: Technician's email address
          example: "emily.chen@hanasalon.com"
        phone:
          type: string
          pattern: "^[\\+]?[1-9][\\d]{0,15}$"
          description: Technician's phone number
          example: "+1234567891"
        employeeId:
          type: string
          description: Unique employee identifier
          example: "EMP001"
        specialties:
          type: array
          items:
            type: string
            enum: [Manicure, Pedicure, Nail Art, Gel Polish, Acrylic Nails, Dip Powder, Nail Extensions, Nail Repair, Cuticle Care, Hand Massage, Foot Massage]
          minItems: 1
          description: Technician's specialties
          example: ["Manicure", "Nail Art", "Gel Polish"]
        skillLevel:
          type: string
          enum: [Junior, Senior, Expert, Master]
          description: Technician's skill level
          example: "Senior"
        certifications:
          type: array
          items:
            type: string
          description: Professional certifications
          example: ["Certified Nail Technician", "Advanced Nail Art"]
        yearsOfExperience:
          type: integer
          minimum: 0
          maximum: 50
          description: Years of experience
          example: 5
        hourlyRate:
          type: number
          minimum: 10
          maximum: 200
          description: Hourly rate in USD
          example: 45.00
        availability:
          $ref: '#/components/schemas/TechnicianAvailability'
        hireDate:
          type: string
          format: date
          description: Date when technician was hired
          example: "2022-03-15"

    TechnicianUpdate:
      type: object
      properties:
        firstName:
          type: string
          maxLength: 50
          description: Technician's first name
          example: "Emily"
        lastName:
          type: string
          maxLength: 50
          description: Technician's last name
          example: "Chen"
        email:
          type: string
          format: email
          description: Technician's email address
          example: "emily.chen@hanasalon.com"
        phone:
          type: string
          pattern: "^[\\+]?[1-9][\\d]{0,15}$"
          description: Technician's phone number
          example: "+1234567891"
        specialties:
          type: array
          items:
            type: string
            enum: [Manicure, Pedicure, Nail Art, Gel Polish, Acrylic Nails, Dip Powder, Nail Extensions, Nail Repair, Cuticle Care, Hand Massage, Foot Massage]
          description: Technician's specialties
          example: ["Manicure", "Nail Art", "Gel Polish"]
        skillLevel:
          type: string
          enum: [Junior, Senior, Expert, Master]
          description: Technician's skill level
          example: "Senior"
        certifications:
          type: array
          items:
            type: string
          description: Professional certifications
          example: ["Certified Nail Technician", "Advanced Nail Art"]
        yearsOfExperience:
          type: integer
          minimum: 0
          maximum: 50
          description: Years of experience
          example: 5
        hourlyRate:
          type: number
          minimum: 10
          maximum: 200
          description: Hourly rate in USD
          example: 45.00
        availability:
          $ref: '#/components/schemas/TechnicianAvailability'
        isActive:
          type: boolean
          description: Whether the technician is active
          example: true
      description: All fields are optional for updates

    TechnicianAvailability:
      type: object
      properties:
        monday:
          $ref: '#/components/schemas/DayAvailability'
        tuesday:
          $ref: '#/components/schemas/DayAvailability'
        wednesday:
          $ref: '#/components/schemas/DayAvailability'
        thursday:
          $ref: '#/components/schemas/DayAvailability'
        friday:
          $ref: '#/components/schemas/DayAvailability'
        saturday:
          $ref: '#/components/schemas/DayAvailability'
        sunday:
          $ref: '#/components/schemas/DayAvailability'

    DayAvailability:
      type: object
      properties:
        start:
          type: string
          pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
          description: Start time in HH:MM format
          example: "09:00"
        end:
          type: string
          pattern: "^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$"
          description: End time in HH:MM format
          example: "17:00"
        available:
          type: boolean
          description: Whether available on this day
          example: true

    # Booking Schemas
    Booking:
      type: object
      properties:
        _id:
          type: string
          description: Unique booking identifier
          example: "691bf2c5779a3bff78c776e9"
        customer:
          $ref: '#/components/schemas/Customer'
        technician:
          $ref: '#/components/schemas/Technician'
        services:
          type: array
          items:
            $ref: '#/components/schemas/Service'
          description: List of services booked
        appointmentDateTime:
          type: string
          format: date-time
          description: Scheduled appointment date and time
          example: "2023-12-01T14:30:00.000Z"
        duration:
          type: integer
          minimum: 15
          maximum: 480
          description: Total duration in minutes
          example: 90
        status:
          type: string
          enum: [initial, confirmed, in_progress, completed, cancelled]
          description: Current booking status
          example: "confirmed"
        totalAmount:
          type: number
          minimum: 0
          description: Total booking amount
          example: 85.50
        paymentStatus:
          type: string
          enum: [pending, paid, refunded, failed]
          description: Payment status
          example: "paid"
        paymentMethod:
          type: string
          enum: [cash, card, online, gift_card]
          description: Payment method used
          example: "card"
        notes:
          type: string
          description: Special notes or requests
          example: "Customer prefers gel polish"
        rating:
          type: number
          minimum: 1
          maximum: 5
          description: Customer rating (1-5 stars)
          example: 4.5
        feedback:
          type: string
          description: Customer feedback
          example: "Excellent service!"
        created_at:
          type: string
          format: date-time
          description: Booking creation timestamp
          example: "2023-11-18T00:15:00.000Z"
        updated_at:
          type: string
          format: date-time
          description: Booking last update timestamp
          example: "2023-11-18T00:15:00.000Z"

    BookingInput:
      type: object
      required:
        - customer
        - technician
        - services
        - appointmentDateTime
      properties:
        customer:
          type: string
          description: Customer ID
          example: "691bf2c5779a3bff78c776e7"
        technician:
          type: string
          description: Technician ID
          example: "691bf2c5779a3bff78c776e8"
        services:
          type: array
          items:
            type: string
          minItems: 1
          description: Array of service IDs
          example: ["691bf2c5779a3bff78c776ea", "691bf2c5779a3bff78c776eb"]
        appointmentDateTime:
          type: string
          format: date-time
          description: Scheduled appointment date and time
          example: "2023-12-01T14:30:00.000Z"
        duration:
          type: integer
          minimum: 15
          maximum: 480
          description: Total duration in minutes (auto-calculated if not provided)
          example: 90
        paymentMethod:
          type: string
          enum: [cash, card, online, gift_card]
          description: Payment method
          example: "card"
        notes:
          type: string
          maxLength: 500
          description: Special notes or requests
          example: "Customer prefers gel polish"

    BookingUpdate:
      type: object
      properties:
        customer:
          type: string
          description: Customer ID
          example: "691bf2c5779a3bff78c776e7"
        technician:
          type: string
          description: Technician ID
          example: "691bf2c5779a3bff78c776e8"
        services:
          type: array
          items:
            type: string
          description: Array of service IDs
          example: ["691bf2c5779a3bff78c776ea", "691bf2c5779a3bff78c776eb"]
        appointmentDateTime:
          type: string
          format: date-time
          description: Scheduled appointment date and time
          example: "2023-12-01T14:30:00.000Z"
        duration:
          type: integer
          minimum: 15
          maximum: 480
          description: Total duration in minutes
          example: 90
        status:
          type: string
          enum: [initial, confirmed, in_progress, completed, cancelled]
          description: Booking status
          example: "confirmed"
        paymentStatus:
          type: string
          enum: [pending, paid, refunded, failed]
          description: Payment status
          example: "paid"
        paymentMethod:
          type: string
          enum: [cash, card, online, gift_card]
          description: Payment method
          example: "card"
        notes:
          type: string
          maxLength: 500
          description: Special notes or requests
          example: "Customer prefers gel polish"
      description: All fields are optional for updates

    ConversationMessage:
      type: object
      required:
        - role
        - content
        - timestamp
      properties:
        role:
          type: string
          enum: [user, assistant]
          description: Message sender role
        content:
          type: string
          description: Message content
        timestamp:
          type: string
          format: date-time
          description: Message timestamp

    Session:
      type: object
      required:
        - session_id
        - created_at
        - last_activity
        - messages
        - booking_state
        - conversation_complete
      properties:
        _id:
          type: string
          description: MongoDB ObjectId
        session_id:
          type: string
          description: Unique session identifier (UUID)
        created_at:
          type: string
          format: date-time
          description: Session creation timestamp
        last_activity:
          type: string
          format: date-time
          description: Last activity timestamp
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ConversationMessage'
          description: Conversation messages
        booking_state:
          type: object
          description: Current booking state
          properties:
            customer_name:
              type: string
            customer_phone:
              type: string
            services_requested:
              type: string
            date_requested:
              type: string
            time_requested:
              type: string
            technician_preference:
              type: string
            customerId:
              type: string
            services:
              type: array
              items:
                type: object
            appointmentDate:
              type: string
            startTime:
              type: string
            endTime:
              type: string
            status:
              type: string
              default: initial
            totalDuration:
              type: integer
              default: 0
            totalPrice:
              type: number
              default: 0.0
            paymentStatus:
              type: string
              default: pending
            paymentMethod:
              type: string
            notes:
              type: string
            customerNotes:
              type: string
            cancellationReason:
              type: string
            confirmationSent:
              type: boolean
              default: false
            rating:
              type: number
            available_technicians:
              type: array
              items:
                type: object
            available_services:
              type: array
              items:
                type: object
            alternative_times:
              type: array
              items:
                type: object
            booking_id:
              type: string
        conversation_complete:
          type: boolean
          default: false
          description: Whether the conversation is complete

  responses:
    BadRequest:
      description: Bad Request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: BAD_REQUEST
            message: Invalid request parameters
            timestamp: "2023-11-18T00:15:00.000Z"
            statusCode: 400

    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: UNAUTHORIZED
            message: Authentication required
            timestamp: "2023-11-18T00:15:00.000Z"
            statusCode: 401

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: NOT_FOUND
            message: Resource not found
            timestamp: "2023-11-18T00:15:00.000Z"
            statusCode: 404

    InternalServerError:
      description: Internal Server Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error: INTERNAL_ERROR
            message: Internal server error
            timestamp: "2023-11-18T00:15:00.000Z"
            statusCode: 500
